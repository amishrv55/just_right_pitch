{% extends "base.html" %}
{% block content %}
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="page-title mb-0">My AI Credits</h2>
    <div>
      <a href="{% url 'credits_request' %}" class="btn btn-primary"><i class="bi bi-lightning-charge me-1"></i> Request Credits</a>
      <a href="{% url 'my_requests' %}" class="btn btn-primary">My Requests Status</a>
    </div>
    <div>
      {% if user.is_staff %}
    <a href="{% url 'credit_requests_list' %}" class="btn btn-primary mt-3">Manage Credit Requests</a>
    {% endif %}
    </div>
  </div>

  <div>
    {% if messages %}
  <div class="container mt-3">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  </div>
{% endif %}

  </div>

  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="metric jrp-card h-100">
        <i class="bi bi-battery-charging"></i>
        <div>
          <div class="text-muted">Current Balance</div>
          <strong>{{ balance }}</strong>
        </div>
      </div>
    </div>
  </div>

  <div class="jrp-card p-3">
    <h5 class="mb-3">Recent Transactions</h5>
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Date</th>
            <th>Delta</th>
            <th>Reason</th>
            <th>Method</th>
            <th>Note</th>
            <th>Balance After</th>
          </tr>
        </thead>
        <tbody>
          {% for t in transactions %}
          <tr>
            <td>{{ t.created_at|date:"M d, Y H:i" }}</td>
            <td class="{% if t.delta < 0 %}text-danger{% else %}text-success{% endif %}">
            {% if t.delta > 0 %}+{% endif %}{{ t.delta }}
            </td>
            <td>{{ t.get_reason_display }}</td>
            <td>{{ t.get_method_display }}</td>
            <td>{{ t.note|default:"â€”" }}</td>
            <td>{{ t.balance_after }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="6" class="text-muted">No transactions yet.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
